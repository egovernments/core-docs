# 6. Deploy DIGIT

#### Topics covered:

* [DIGIT platform service deployment basics](6.-deploy-digit.md#overview)
* [Pre-requisites for deployment](6.-deploy-digit.md#pre-requisites)
* [Steps to run the deployer](6.-deploy-digit.md#run-deployer)
* [Adding security group](6.-deploy-digit.md#adding-security-group-id-of-instance-ec2-to-rds)

## Overview

Once all the deployments configs are ready, you can now run the following command and provide the necessary details asked and this interactive installer, it will take care of the rest.

**What you can try to deploy is:**

* DIGIT's core platform services
* PGR&#x20;
* TL (Trade License)
* PT (Property Tax)
* WS (Water & Sewerage)
* etc

## **Pre-requisites**

1. DIGIT uses [golang](https://golang.org/doc/install#download) (required v1.13.3) automated scripts to deploy the builds onto Kubernetes - [Linux](https://golang.org/dl/go1.13.3.linux-amd64.tar.gz) or [Windows](https://golang.org/dl/go1.13.3.windows-amd64.msi) or [Mac](https://golang.org/dl/go1.13.3.darwin-amd64.pkg)
2. All DIGIT services are packaged using helm charts[ ![](https://helm.sh/img/favicon-152.png)Installing Helm](https://helm.sh/docs/intro/install/)
3. [kubectl](https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/) is a CLI to connect to the Kubernetes cluster from your machine
4. Install [CURL](https://help.ubidots.com/en/articles/2165289-learn-how-to-install-run-curl-on-windows-macosx-linux) for making API calls
5. [Install Visualstudio](https://code.visualstudio.com/download) IDE Code for better code/configuration editing capabilities
6. [Install Postman](https://www.postman.com/downloads/) to run digit bootstrap scripts

## Run Deployer

1. Run the egov-deployer golang script from the [DIGIT-Devops repo](https://github.com/egovernments/DIGIT-DevOps).

```
root@ip:# cd DIGIT-DevOps/deploy-as-code/deployer

root@ip:# go run standalone_installer.go

#Be prepared for the following questions
1. Do you have the Kubernetes Setup?
2. Provide the path of the intented env kubeconfig file
3. Which version of the DIGIT that you want to install
4. What DIGIT Modules that you choose to install (Choose PGR)
5. All, done, Now do you want to preview the deployment manifests 
6. Are you good to proceed with the DIGIT Installation

All Done.
```

All done, wait and watch for 10 min. The DIGIT setup is complete and the application will be running on the given URL.

<mark style="color:red;">**Note**</mark><mark style="color:red;">:</mark>&#x20;

* <mark style="color:red;">If you do not have your domain yet, you can edit the host file entries and map the nginx-ingress-service loadbalancer id like below</mark>&#x20;
  * <mark style="color:red;">When you find it, add the following lines to the host file, save and close the file.</mark>
  * <mark style="color:red;">`aws-load-balancer-id digit.try.com`</mark>
* <mark style="color:red;">If you have a GoDaddy account or similar and a DNS records edit access you can map the load balancer id to desired DNS  Create a</mark> [<mark style="color:red;">cname</mark>](https://in.godaddy.com/help/add-a-cname-record-19236) <mark style="color:red;">record with the load balancer ID and domain.</mark>

You can now test the DIGIT application status in the command prompt/terminal by using the below command.

```
curl -Is http://digit.try.com/employee/login |  head -n 1

OutPut:
HTTP/2 200
```

<mark style="color:red;">**Note**</mark><mark style="color:red;">: Initially pgr-services would be in crashloopbackoff state, but after performing the post-deployment steps the pgr-services will start running.</mark>

## Adding Security Group ID of Instance(EC2) to RDS:

After deploying your environment config into the EC2 cluster, we have to add the **security group ID** of instance to **RDS**.

&#x20;Here are the steps:

1. Go to **AWS console** and search for **EC2.**&#x20;
2. Click on **Instances** and select the **Instance ID** of which you had created.
3. Scroll down and go to **Security** and copy the **Security Group ID.** It will start with **sg-xxxxxxxxxxxxxxxxx.**&#x20;
4. In search bar, search for **RDS** and then go to **Databases**. Choose the **db** you had created already.&#x20;
5. Scroll down for **Security Group rules** and click any one **sg**. It will redirect into another tab.
6. Scroll down and click on **Edit inbound rules**. Click on **Add rule**.
7. change the **Type** to **Postgresql** and paste the copied **sg-xxxxxxxxxxxxxxxxx** beside the **custom** and click on **save rules.**



